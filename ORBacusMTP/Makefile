# Makefile for IIOP MTP 

# The following targets are not file names
.PHONY: all batch classes clean lib

JADELIB     =   ../../lib/jade.jar
ORBACUSLIB  =   ../../OB.jar
LIBNAME	    =	iiopOB.jar
CLSDIR      =	classes
BATCH_MAKE  =	make.bat
BATCH_CLEAN =	clean.bat

AR = jar
ARFLAGS = cvf
MAKE = make
IDLCC = jidl
JC = javac
JFLAGS = -deprecation -O -d $(CLSDIR) -classpath .:$(JADELIB):$(ORBACUSLIB)

SOURCES     = 	MessageTransportProtocol.java
IDLSPEC     =   fipa.idl

IDLSTUBS    =   FIPA/AgentID.java \
		FIPA/AgentIDHelper.java \
		FIPA/AgentIDHolder.java \
		FIPA/AgentIDsHelper.java \
		FIPA/AgentIDsHolder.java \
		FIPA/DateTime.java \
		FIPA/DateTimeHelper.java \
		FIPA/DateTimeHolder.java \
		FIPA/Envelope.java \
		FIPA/EnvelopeHelper.java \
		FIPA/EnvelopeHolder.java \
		FIPA/EnvelopesHelper.java \
		FIPA/EnvelopesHolder.java \
		FIPA/FipaMessage.java \
		FIPA/FipaMessageHelper.java \
		FIPA/FipaMessageHolder.java \
		FIPA/MTS.java \
		FIPA/MTSHelper.java \
		FIPA/MTSHolder.java \
		FIPA/OptAgentIDHelper.java \
		FIPA/OptAgentIDHolder.java \
		FIPA/OptDateTimeHelper.java \
		FIPA/OptDateTimeHolder.java \
		FIPA/OptReceivedObjectHelper.java \
		FIPA/OptReceivedObjectHolder.java \
		FIPA/OptTransportBehaviourTypeHelper.java \
		FIPA/OptTransportBehaviourTypeHolder.java \
		FIPA/PayloadHelper.java \
		FIPA/PayloadHolder.java \
		FIPA/Property.java \
		FIPA/PropertyHelper.java \
		FIPA/PropertyHolder.java \
		FIPA/ReceivedObject.java \
		FIPA/ReceivedObjectHelper.java \
		FIPA/ReceivedObjectHolder.java \
		FIPA/TransportBehaviourTypeHelper.java \
		FIPA/TransportBehaviourTypeHolder.java \
		FIPA/URLHelper.java \
		FIPA/MTSOperations.java \
		FIPA/MTSPOA.java \
		FIPA/_MTSStub.java \
		FIPA/stringsHelper.java \
		FIPA/stringsHolder.java

all: idl classes lib
	@echo
	@echo Build complete.
	@echo

idl: $(IDLSTUBS)
	@echo IDL stubs and skeletons generated

$(IDLSTUBS): $(IDLSPEC)
	$(IDLCC) $<

classes:
	$(JC) $(JFLAGS) $(SOURCES)

lib:
	cd $(CLSDIR); \
	$(AR) $(ARFLAGS) ../$(LIBNAME) *; \

dist:
	$(AR) $(ARFLAGS) ../ORBacusMTP.zip *

batch:
	rm -f $(BATCH_MAKE) $(BATCH_CLEAN)
	echo '@REM ===============================================================' > $(BATCH_MAKE)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_MAKE)
	echo '@REM ===============================================================' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo $(IDLCC) $(IDLSPEC) >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo '$(JC) $(subst :,;,$(subst /,\,$(JFLAGS))) $(subst /,\,$(SOURCES))' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo 'cd $(CLSDIR)' >> $(BATCH_MAKE)
	echo '$(AR) $(ARFLAGS) ..\$(LIBNAME) *' >> $(BATCH_MAKE)
	echo 'cd ..' >> $(BATCH_MAKE)
	echo '$(AR) $(ARFLAGS) ..\ORBacusMTP.zip *' >> $(BATCH_MAKE)
	echo >> $(BATCH_MAKE)
	echo '@REM ===============================================================' > $(BATCH_CLEAN)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_CLEAN)
	echo '@REM ===============================================================' >> $(BATCH_CLEAN)
	echo >> $(BATCH_CLEAN)
	echo >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(IDLSTUBS))' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(LIBNAME))' >> $(BATCH_CLEAN)
	echo 'rmdir /S /Q $(CLSDIR)\*' >> $(BATCH_CLEAN) # For Win NT 4
	echo 'deltree /Y $(CLSDIR)\*' >> $(BATCH_CLEAN)  # For Win 95/98

clean:
	rm -rf $(IDLSTUBS) $(CLSDIR) $(LIBNAME) `find . -name '*~'` `find . -name '#*#'`
	mkdir -p $(CLSDIR)
